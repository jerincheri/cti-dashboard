{% extends "base.html" %}

{% block content %}
<div class="container">
  <div class="row mb-4">
    <div class="col">
      <h2 class="text-info">ðŸ“Š Dashboard Overview</h2>
      <p class="text-secondary">Real-time threat intelligence from OTX and local DB.</p>
    </div>
  </div>

  <!-- Threat Stats -->
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card shadow-lg">
        <div class="card-body text-center">
          <h5 class="card-title">Total IOCs</h5>
          <h2 class="text-info">{{ stats.total }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-lg">
        <div class="card-body text-center">
          <h5 class="card-title">High Threats</h5>
          <h2 class="text-danger">{{ stats.high }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-lg">
        <div class="card-body text-center">
          <h5 class="card-title">Medium Threats</h5>
          <h2 class="text-warning">{{ stats.medium }}</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent IOCs -->
  <div class="row mt-5">
    <div class="col-md-12">
      <div class="card shadow-lg">
        <div class="card-header text-info">ðŸ•µ Recent IOCs</div>
        <div class="card-body">
          {% if recent %}
            <table class="table table-dark table-striped table-hover">
              <thead>
                <tr>
                  <th>Value</th>
                  <th>Type</th>
                  <th>Source</th>
                  <th>Threat Level</th>
                  <th>Timestamp</th>
                </tr>
              </thead>
              <tbody>
                {% for item in recent %}
                <tr>
                  <td>{{ item.value }}</td>
                  <td>{{ item.type }}</td>
                  <td>{{ item.source }}</td>
                  <td>
                    {% if item.threat == "High" %}
                      <span class="badge bg-danger">High</span>
                    {% elif item.threat == "Medium" %}
                      <span class="badge bg-warning text-dark">Medium</span>
                    {% else %}
                      <span class="badge bg-success">Low</span>
                    {% endif %}
                  </td>
                  <td>{{ item.timestamp }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="text-muted">No recent IOCs available.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Threat Trends (Chart Placeholder) -->
  <div class="row mt-5">
    <div class="col-md-12">
      <div class="card shadow-lg">
        <div class="card-header text-info">ðŸ“ˆ Threat Trends Over Time</div>
        <div class="card-body">
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('trendChart').getContext('2d');
  const trendChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart.labels | safe }},
      datasets: [{
        label: 'Threats',
        data: {{ chart.data | safe }},
        borderColor: '#00d4d4',
        backgroundColor: 'rgba(0, 212, 212, 0.2)',
        tension: 0.3,
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { labels: { color: '#f8f9fa' } }
      },
      scales: {
        x: { ticks: { color: '#f8f9fa' } },
        y: { ticks: { color: '#f8f9fa' } }
      }
    }
  });
</script>
{% endblock %}
